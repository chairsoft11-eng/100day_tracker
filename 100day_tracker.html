<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>100ì¼ ë‹¤ì´ì–´íŠ¸ íŠ¸ë˜ì»¤ Pro</title>
    
    <!-- ì•„ì´í° ì›¹ì•± ì„¤ì • (ì¶”ê°€ë¨) -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="D-100 Diet">
    <!-- í™ˆ í™”ë©´ ì•„ì´ì½˜ (í°íŠ¸ì–´ì¸ ì•„ì´ì½˜ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ì–´ í…ìŠ¤íŠ¸ ê¸°ë°˜ì´ë‚˜ ê¸°ë³¸ ìŠ¤í¬ë¦°ìƒ·ì´ ëœ¨ì§€ë§Œ, ì„¤ì •ì„ ìœ„í•´ ì¶”ê°€) -->
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2964/2964514.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; -webkit-tap-highlight-color: transparent; }
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        /* Slider Styling */
        input[type=range] {
            -webkit-appearance: none; width: 100%; background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%;
            background: #ffffff; border: 2px solid #4F46E5; cursor: pointer; margin-top: -8px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 6px; cursor: pointer; background: #E5E7EB; border-radius: 3px;
        }
        /* Pain Scale Gradient */
        .pain-gradient {
            background: linear-gradient(to right, #10B981, #FBBF24, #EF4444);
            height: 6px; border-radius: 3px; width: 100%; position: absolute; top: 9px; z-index: -1;
        }
        .nav-item.active { color: #4F46E5; }
        .nav-item { color: #9CA3AF; }
        
        /* Calendar Specific */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        .calendar-day:hover { background-color: #EEF2FF; }
        .calendar-day.selected { background-color: #4F46E5; color: white; box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.3); }
        .calendar-day.today { border: 2px solid #4F46E5; font-weight: bold; }
        .dot { width: 6px; height: 6px; border-radius: 50%; margin-top: 4px; }
        .dot.success { background-color: #10B981; }
        .dot.missed { background-color: #EF4444; }
        .dot.none { display: none; }
        
        /* iOS Safe Area ëŒ€ì‘ */
        header { padding-top: max(1.5rem, env(safe-area-inset-top)); }
        nav { padding-bottom: env(safe-area-inset-bottom); height: calc(4rem + env(safe-area-inset-bottom)); }
        body { padding-bottom: calc(6rem + env(safe-area-inset-bottom)); }
    </style>
</head>
<body class="bg-slate-100 min-h-screen text-gray-800">

    <!-- ìƒë‹¨ í—¤ë” -->
    <header class="bg-indigo-600 text-white p-6 rounded-b-3xl shadow-lg relative overflow-hidden transition-all duration-300" id="main-header">
        <div class="relative z-10">
            <div class="flex justify-between items-start mb-2">
                <div id="header-title-area">
                    <h1 class="text-2xl font-bold" id="header-main-text">D-100 Pro</h1>
                    <p class="text-indigo-100 text-xs" id="header-sub-text">ë¬´ë¦ í†µì¦ ì¼€ì–´ & ë‹¤ì´ì–´íŠ¸</p>
                </div>
                <!-- ìƒë¦¬ ì£¼ê¸° í† ê¸€ -->
                <button onclick="togglePeriod()" id="period-btn" class="bg-indigo-500 hover:bg-pink-400 text-xs px-3 py-1.5 rounded-full transition-colors border border-indigo-400 flex items-center gap-1">
                    <i class="fas fa-venus"></i> <span>ìƒë¦¬ X</span>
                </button>
            </div>
            
            <div class="flex justify-between items-end mt-4">
                <div>
                    <span id="d-day-display" class="text-4xl font-bold text-yellow-300">D-100</span>
                    <p class="text-xs opacity-80 mt-1">Target: 49kg (-10kg)</p>
                </div>
                <div class="text-right">
                    <p class="text-xs opacity-70 mb-1" id="weight-input-label">ì˜¤ëŠ˜ ì²´ì¤‘</p>
                    <div class="flex items-end gap-1 justify-end">
                        <input type="number" id="daily-weight" placeholder="59.0" class="w-16 bg-white/20 text-white text-right font-bold p-1 rounded border-b border-white/50 focus:outline-none focus:bg-white/30 placeholder-indigo-300 text-lg">
                        <span class="text-sm mb-1">kg</span>
                    </div>
                </div>
            </div>
            <!-- ìƒë¦¬ ì¤‘ì¼ ë•Œ ë‚˜íƒ€ë‚˜ëŠ” ë©”ì‹œì§€ -->
            <div id="period-msg" class="hidden mt-2 bg-pink-500/30 p-2 rounded text-xs text-pink-100">
                <i class="fas fa-info-circle"></i> í˜¸ë¥´ëª¬ ì˜í–¥ìœ¼ë¡œ ì²´ì¤‘ì´ 1~2kg ëŠ˜ ìˆ˜ ìˆì–´ìš”. ê°€ì§œ ì‚´ì´ë‹ˆ ì•ˆì‹¬í•˜ì„¸ìš”!
            </div>
        </div>
        <div class="absolute top-0 right-0 -mt-4 -mr-4 w-32 h-32 bg-white/10 rounded-full blur-xl"></div>
    </header>

    <!-- 1. íŠ¸ë˜ì»¤ ë·° (ê¸°ë³¸) -->
    <main class="p-4 space-y-5" id="view-tracker">
        <!-- ìƒë‹¨ ì•Œë¦¼ ë°” (ê³¼ê±° ë‚ ì§œ ìˆ˜ì • ì‹œ í‘œì‹œ) -->
        <div id="edit-mode-banner" class="hidden bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-3 rounded shadow-sm text-sm flex justify-between items-center">
            <span><i class="fas fa-history mr-2"></i> ê³¼ê±° ê¸°ë¡ì„ ìˆ˜ì • ì¤‘ì…ë‹ˆë‹¤.</span>
            <button onclick="resetToToday()" class="text-xs bg-yellow-200 px-2 py-1 rounded font-bold hover:bg-yellow-300">ì˜¤ëŠ˜ë¡œ ë³µê·€</button>
        </div>

        <!-- 1. ì»¨ë””ì…˜ ì²´í¬ (ìˆ˜ë©´ & í†µì¦) -->
        <section class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
            <h2 class="text-sm font-bold mb-4 flex items-center text-gray-700">
                <i class="fas fa-heartbeat mr-2 text-red-500"></i> ì»¨ë””ì…˜ ì²´í¬
            </h2>
            
            <!-- ìˆ˜ë©´ -->
            <div class="mb-4">
                <p class="text-xs text-gray-500 mb-2">ìˆ˜ë©´ í€„ë¦¬í‹° (ì•¼ê°„ ê·¼ë¬´ í›„)</p>
                <div class="flex gap-2">
                    <button onclick="setSleep('good')" id="sleep-good" class="flex-1 py-2 rounded-lg border border-gray-200 text-xl grayscale hover:grayscale-0 transition active:scale-95">ğŸ˜Š</button>
                    <button onclick="setSleep('soso')" id="sleep-soso" class="flex-1 py-2 rounded-lg border border-gray-200 text-xl grayscale hover:grayscale-0 transition active:scale-95">ğŸ˜</button>
                    <button onclick="setSleep('bad')" id="sleep-bad" class="flex-1 py-2 rounded-lg border border-gray-200 text-xl grayscale hover:grayscale-0 transition active:scale-95">ğŸ˜«</button>
                </div>
            </div>

            <!-- í†µì¦ ì²™ë„ (VAS) -->
            <div class="relative pt-1">
                <div class="flex justify-between text-xs text-gray-500 mb-1">
                    <span>ë¬´ë¦ í†µì¦</span>
                    <span id="pain-value" class="font-bold text-indigo-600">0 - í†µì¦ ì—†ìŒ</span>
                </div>
                <div class="relative h-6">
                    <div class="pain-gradient"></div>
                    <input type="range" min="0" max="10" value="0" class="absolute top-0 w-full h-2 bg-transparent appearance-none cursor-pointer" oninput="updatePain(this.value)">
                </div>
                <p id="pain-advice" class="text-xs mt-1 text-gray-400">0~3ì : ìš´ë™ ê°€ëŠ¥ êµ¬ê°„ì…ë‹ˆë‹¤.</p>
            </div>
        </section>

        <!-- 2. ìˆ˜ë¶„ & ì»¤í”¼ -->
        <section class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
            <h2 class="text-sm font-bold mb-3 flex items-center text-gray-700">
                <i class="fas fa-tint mr-2 text-blue-500"></i> ìˆ˜ë¶„ & ì»¤í”¼
            </h2>
            <div class="flex justify-between items-center gap-4">
                <!-- ì»¤í”¼ í† ê¸€ -->
                <button onclick="toggleCoffee()" id="coffee-btn" class="flex items-center gap-2 px-3 py-2 rounded-xl border border-gray-200 text-gray-400 text-xs font-bold transition-all">
                    <i class="fas fa-coffee text-sm"></i> <span>ëª¨ë‹ ì»¤í”¼</span>
                </button>
                
                <!-- ë¬¼ ì¹´ìš´í„° -->
                <div class="flex-1 bg-blue-50 rounded-xl p-2 flex justify-between items-center">
                    <div class="text-xs font-medium text-blue-800 ml-2">
                        <span id="water-count" class="text-lg font-bold">0</span> / 8ì”
                    </div>
                    <button onclick="addWater()" class="bg-blue-500 text-white w-8 h-8 rounded-full shadow-md hover:bg-blue-600 active:scale-90 transition">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            </div>
        </section>

        <!-- 3. ì‹ë‹¨ ê¸°ë¡ -->
        <section class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
            <h2 class="text-sm font-bold mb-3 flex items-center text-gray-700 justify-between">
                <div><i class="fas fa-utensils mr-2 text-green-500"></i> ì‹ë‹¨ ê¸°ë¡</div>
                <button class="text-xs text-gray-400 bg-gray-100 px-2 py-1 rounded" onclick="alert('ì‹œê°„ì„ í´ë¦­í•˜ì—¬ ìˆ˜ì •í•˜ì„¸ìš”')"><i class="fas fa-cog"></i> ì„¤ì •</button>
            </h2>

            <div class="space-y-3" id="meal-container">
                <!-- JS Rendering -->
            </div>
        </section>

        <!-- 4. ìš´ë™ ë£¨í‹´ -->
        <section class="bg-white p-5 rounded-2xl shadow-sm border-l-4 border-indigo-500">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-sm font-bold text-gray-700 flex items-center">
                    <i class="fas fa-dumbbell mr-2 text-indigo-500"></i> ìš´ë™ ë£¨í‹´
                </h2>
                <div class="bg-gray-100 p-1 rounded-lg flex text-xs font-bold">
                    <button onclick="setMode('work')" id="btn-work" class="px-3 py-1.5 rounded-md shadow-sm bg-white text-indigo-600 transition">ê·¼ë¬´ì¼</button>
                    <button onclick="setMode('off')" id="btn-off" class="px-3 py-1.5 rounded-md text-gray-400 transition">íœ´ë¬´ì¼</button>
                </div>
            </div>

            <ul id="exercise-list" class="space-y-2">
                <!-- Short foot is always included -->
            </ul>
        </section>
        
        <button onclick="saveDailyLog()" class="w-full bg-indigo-600 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-indigo-700 active:scale-95 transition flex justify-center items-center mt-2 mb-4">
            <i class="fas fa-check-circle mr-2"></i> <span id="save-btn-text">ì˜¤ëŠ˜ ê¸°ë¡ ì™„ë£Œ</span>
        </button>
    </main>

    <!-- 2. ë‹¬ë ¥ ë·° (ìˆ¨ê¹€) -->
    <main class="p-5 space-y-6 hidden" id="view-calendar">
        <section class="bg-white p-5 rounded-2xl shadow-sm">
            <div class="flex justify-between items-center mb-6">
                <button onclick="changeMonth(-1)" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 text-gray-500"><i class="fas fa-chevron-left"></i></button>
                <h2 class="text-lg font-bold text-gray-800" id="current-month-year">2024ë…„ 5ì›”</h2>
                <button onclick="changeMonth(1)" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 text-gray-500"><i class="fas fa-chevron-right"></i></button>
            </div>

            <!-- ìš”ì¼ í—¤ë” -->
            <div class="grid grid-cols-7 gap-2 mb-2 text-center text-xs font-bold text-gray-400">
                <div class="text-red-400">ì¼</div>
                <div>ì›”</div>
                <div>í™”</div>
                <div>ìˆ˜</div>
                <div>ëª©</div>
                <div>ê¸ˆ</div>
                <div class="text-blue-400">í† </div>
            </div>

            <!-- ë‚ ì§œ ê·¸ë¦¬ë“œ -->
            <div class="calendar-grid" id="calendar-days">
                <!-- JS Generated -->
            </div>
            
            <div class="mt-6 flex justify-center gap-4 text-xs text-gray-500">
                <div class="flex items-center gap-1"><div class="dot success"></div> ê¸°ë¡ ì™„ë£Œ</div>
                <div class="flex items-center gap-1"><div class="dot missed"></div> ê¸°ë¡ ëˆ„ë½</div>
            </div>
        </section>

        <div class="bg-indigo-50 p-4 rounded-xl border border-indigo-100">
             <h3 class="font-bold text-indigo-800 text-sm mb-1"><i class="fas fa-history"></i> ë¹ˆí‹ˆ ì±„ìš°ê¸°</h3>
             <p class="text-xs text-indigo-700 leading-relaxed">
                ë¹¨ê°„ ì ì´ ìˆëŠ” ë‚ ì§œëŠ” ê¸°ë¡ì´ ëˆ„ë½ëœ ë‚ ì…ë‹ˆë‹¤. 
                í•´ë‹¹ ë‚ ì§œë¥¼ í´ë¦­í•˜ë©´ ê·¸ë‚ ì˜ ê¸°ë¡ì„ ì±„ì›Œ ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
             </p>
        </div>
    </main>

    <!-- 3. í†µê³„ ë·° (ìˆ¨ê¹€) -->
    <main class="p-5 space-y-6 hidden" id="view-stats">
        <!-- ì²´ì¤‘ ê·¸ë˜í”„ -->
        <section class="bg-white p-5 rounded-2xl shadow-sm">
            <h2 class="text-lg font-bold mb-4 text-indigo-800">ğŸ“‰ ì²´ì¤‘ ë³€í™” ë¡œê·¸</h2>
            <div class="h-64 w-full">
                <canvas id="weightChart"></canvas>
            </div>
        </section>
        
        <!-- í†µì¦ ë³€í™” ê·¸ë˜í”„ -->
        <section class="bg-white p-5 rounded-2xl shadow-sm">
            <h2 class="text-lg font-bold mb-2 text-red-500">ğŸ©¹ ë¬´ë¦ í†µì¦ ì¶”ì´</h2>
            <p class="text-xs text-gray-400 mb-4">í†µì¦ì´ 5ì  ì´ìƒì´ë©´ íœ´ì‹ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
            <div class="h-40 w-full">
                <canvas id="painChart"></canvas>
            </div>
        </section>
    </main>

    <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ (3ê°œ íƒ­) -->
    <nav class="fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 flex justify-around items-center z-50 shadow-[0_-5px_10px_rgba(0,0,0,0.02)]">
        <button onclick="switchTab('tracker')" class="nav-item active flex flex-col items-center justify-center w-full h-full" id="nav-tracker">
            <i class="fas fa-calendar-check text-lg mb-1"></i>
            <span class="text-[10px] font-bold">ê¸°ë¡í•˜ê¸°</span>
        </button>
        <button onclick="switchTab('calendar')" class="nav-item flex flex-col items-center justify-center w-full h-full" id="nav-calendar">
            <i class="fas fa-calendar-alt text-lg mb-1"></i>
            <span class="text-[10px] font-bold">ë‹¬ë ¥</span>
        </button>
        <button onclick="switchTab('stats')" class="nav-item flex flex-col items-center justify-center w-full h-full" id="nav-stats">
            <i class="fas fa-chart-line text-lg mb-1"></i>
            <span class="text-[10px] font-bold">í†µê³„</span>
        </button>
    </nav>

    <!-- ì•Œë¦¼ -->
    <div id="toast" class="fixed top-5 left-1/2 transform -translate-x-1/2 bg-gray-900/90 backdrop-blur text-white px-6 py-3 rounded-full shadow-2xl opacity-0 pointer-events-none transition-opacity duration-300 z-50 text-sm font-bold flex items-center">
        <i class="fas fa-check-circle text-green-400 mr-2"></i> <span>ì €ì¥ ì™„ë£Œ!</span>
    </div>

    <script>
        // --- ë°ì´í„° ìƒíƒœ ---
        let currentMode = 'work'; 
        let waterIntake = 0;
        let isCoffeeDrank = false;
        let isPeriod = false;
        let sleepQuality = null; 
        let painLevel = 0;
        
        // ë‚ ì§œ ê´€ë ¨ ìƒíƒœ
        let today = new Date();
        let currentMonthDate = new Date(); // ë‹¬ë ¥ì—ì„œ ë³´ê³  ìˆëŠ” ì›”
        let editingDate = new Date(); // í˜„ì¬ ê¸°ë¡/ìˆ˜ì • ì¤‘ì¸ ë‚ ì§œ (ê¸°ë³¸ ì˜¤ëŠ˜)

        // ê¸°ë¡ ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„° (ë‹¬ë ¥ ì  í‘œì‹œìš©)
        // ë‚ ì§œ ë¬¸ìì—´(YYYY-MM-DD) í‚¤ë¡œ ê°€ì§. trueë©´ ê¸°ë¡ë¨.
        const recordStatus = {}; 

        let meals = [
            { id: 'breakfast', time: '11:30', name: 'ê¸°ìƒ ì§í›„', desc: 'ì‚¬ê³¼, ê³„ë€, ë‘ìœ ', type: 'light' },
            { id: 'lunch', time: '14:30', name: 'ì¶œê·¼ ì „ (ë©”ì¸)', desc: 'ì¼ë°˜ì‹ 1/2', type: 'heavy' },
            { id: 'dinner', time: '19:00', name: 'ê·¼ë¬´ ì¤‘', desc: 'ë‹¨ë°±ì§ˆ ìœ„ì£¼', type: 'protein' },
            { id: 'snack', time: '23:30', name: 'ê°„ì‹ (ì„ íƒ)', desc: 'ì•¼ì±„ìŠ¤í‹±/ê²¬ê³¼ë¥˜', type: 'optional' }
        ];

        const routines = {
            work: [
                { name: 'ë°œë°”ë‹¥ ì•„ì¹˜ ë§Œë“¤ê¸° (ìˆí’‹)', time: 'ìˆ˜ì‹œë¡œ', icon: 'fa-shoe-prints', tag: 'ë§¤ì¼í•„ìˆ˜' },
                { name: 'Lì ë‹¤ë¦¬ (ë¶€ì¢…ì œê±°)', time: '20ë¶„', icon: 'fa-bed', tag: 'í•„ìˆ˜' },
                { name: 'ì¢…ì•„ë¦¬/ì•ˆìª½ í¼ë¡¤ëŸ¬', time: '15ë¶„', icon: 'fa-hockey-puck', tag: 'ë§ˆì‚¬ì§€' },
                { name: 'ë¸Œë¦¿ì§€ (ì—‰ë©ì´)', time: '15íšŒx3', icon: 'fa-child', tag: 'ì¬í™œ' }
            ],
            off: [
                { name: 'ë°œë°”ë‹¥ ì•„ì¹˜ ë§Œë“¤ê¸° (ìˆí’‹)', time: '3ë¶„', icon: 'fa-shoe-prints', tag: 'ë§¤ì¼í•„ìˆ˜' },
                { name: 'ì‹¤ë‚´ ìì „ê±° (ì•ˆì¥ ë†’ê²Œ)', time: '40ë¶„', icon: 'fa-bicycle', tag: 'ìœ ì‚°ì†Œ' },
                { name: 'ìƒì²´ ë£¨í‹´ (ë“±/ì–´ê¹¨)', time: '20ë¶„', icon: 'fa-dumbbell', tag: 'ê·¼ë ¥' },
                { name: 'ìŠ¤í‹°í”„ ë°ë“œë¦¬í”„íŠ¸', time: '15íšŒx3', icon: 'fa-weight-hanging', tag: 'í›„ë©´' },
                { name: 'í”Œë­í¬', time: '30ì´ˆx4', icon: 'fa-running', tag: 'ì½”ì–´' }
            ]
        };

        let weightChartInstance = null;
        let painChartInstance = null;

        // --- ì´ˆê¸°í™” ---
        window.onload = function() {
            initMockData(); // ë°ëª¨ìš© ê³¼ê±° ë°ì´í„° ìƒì„±
            renderMeals();
            setMode('work');
            initCharts();
            renderCalendar();
            updateHeaderDate();
        };

        // ë°ëª¨ìš© ë°ì´í„° ìƒì„± (ì§€ë‚œ 5ì¼ê°„ ì¼ë¶€ëŠ” ê¸°ë¡, ì¼ë¶€ëŠ” ëˆ„ë½)
        function initMockData() {
            for(let i=1; i<=5; i++) {
                let d = new Date();
                d.setDate(d.getDate() - i);
                const key = formatDateKey(d);
                // ëœë¤í•˜ê²Œ ê¸°ë¡ ì—¬ë¶€ ê²°ì • (ì§ìˆ˜ë‚ ì€ ê¸°ë¡í•¨)
                if(i % 2 === 0) recordStatus[key] = true; 
            }
        }
        
        function formatDateKey(date) {
            return `${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()}`;
        }

        // --- ë‹¬ë ¥ ë¡œì§ ---
        function renderCalendar() {
            const year = currentMonthDate.getFullYear();
            const month = currentMonthDate.getMonth();
            
            document.getElementById('current-month-year').innerText = `${year}ë…„ ${month + 1}ì›”`;
            
            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            
            const grid = document.getElementById('calendar-days');
            grid.innerHTML = '';
            
            // ë¹ˆ ì¹¸ ì±„ìš°ê¸°
            for (let i = 0; i < firstDay; i++) {
                grid.innerHTML += `<div></div>`;
            }
            
            const todayKey = formatDateKey(today);
            const editingKey = formatDateKey(editingDate);

            // ë‚ ì§œ ìƒì„±
            for (let i = 1; i <= lastDate; i++) {
                const thisDate = new Date(year, month, i);
                const key = formatDateKey(thisDate);
                const isToday = (key === todayKey);
                const isSelected = (key === editingKey);
                
                let dotClass = 'none';
                // ë¯¸ë˜ ë‚ ì§œê°€ ì•„ë‹ˆê³ , ê¸°ë¡ì´ ìˆìœ¼ë©´ success, ì—†ìœ¼ë©´ missed (ë°ëª¨ìš©: ì˜¤ëŠ˜ ì´ì „ ë‚ ì§œë§Œ)
                if (thisDate < today) {
                    dotClass = recordStatus[key] ? 'success' : 'missed';
                } else if (isToday) {
                     // ì˜¤ëŠ˜ì€ ê¸°ë¡í–ˆìœ¼ë©´ success
                     dotClass = recordStatus[key] ? 'success' : 'none';
                }

                grid.innerHTML += `
                    <div class="calendar-day ${isToday ? 'today' : ''} ${isSelected ? 'selected' : ''}" 
                         onclick="selectDate(${year}, ${month}, ${i})">
                        <span>${i}</span>
                        <div class="dot ${dotClass}"></div>
                    </div>
                `;
            }
        }

        function changeMonth(delta) {
            currentMonthDate.setMonth(currentMonthDate.getMonth() + delta);
            renderCalendar();
        }

        function selectDate(year, month, day) {
            editingDate = new Date(year, month, day);
            updateHeaderDate(); // í—¤ë” ì—…ë°ì´íŠ¸
            renderCalendar(); // ì„ íƒ í‘œì‹œ ì—…ë°ì´íŠ¸
            switchTab('tracker'); // íŠ¸ë˜ì»¤ ë·°ë¡œ ì´ë™
            
            // ê³¼ê±° ë‚ ì§œë©´ ë°°ë„ˆ í‘œì‹œ
            const todayKey = formatDateKey(today);
            const editKey = formatDateKey(editingDate);
            
            if (editKey !== todayKey) {
                document.getElementById('edit-mode-banner').classList.remove('hidden');
                document.getElementById('save-btn-text').innerText = `${month+1}ì›” ${day}ì¼ ê¸°ë¡ ì €ì¥`;
                document.getElementById('weight-input-label').innerText = "ê·¸ë‚  ì²´ì¤‘";
            } else {
                resetToTodayUI();
            }
            
            // (ì‹¤ì œ ì•±ì—ì„œëŠ” ì—¬ê¸°ì„œ í•´ë‹¹ ë‚ ì§œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ì•¼ í•¨. ì—¬ê¸°ì„  í¼ ë¦¬ì…‹ë§Œ ì‹œë®¬ë ˆì´ì…˜)
            resetFormForDemo();
        }

        function resetToToday() {
            editingDate = new Date();
            updateHeaderDate();
            renderCalendar();
            resetToTodayUI();
            resetFormForDemo();
        }

        function resetToTodayUI() {
            document.getElementById('edit-mode-banner').classList.add('hidden');
            document.getElementById('save-btn-text').innerText = "ì˜¤ëŠ˜ ê¸°ë¡ ì™„ë£Œ";
            document.getElementById('weight-input-label').innerText = "ì˜¤ëŠ˜ ì²´ì¤‘";
        }
        
        function updateHeaderDate() {
            const isToday = formatDateKey(editingDate) === formatDateKey(today);
            
            if (isToday) {
                document.getElementById('header-main-text').innerText = "D-100 Pro";
                document.getElementById('header-sub-text').innerText = "ë¬´ë¦ í†µì¦ ì¼€ì–´ & ë‹¤ì´ì–´íŠ¸";
                document.getElementById('d-day-display').innerText = "D-100";
            } else {
                const m = editingDate.getMonth() + 1;
                const d = editingDate.getDate();
                document.getElementById('header-main-text').innerText = `${m}ì›” ${d}ì¼ ê¸°ë¡`;
                document.getElementById('header-sub-text').innerText = "ê³¼ê±° ê¸°ë¡ ìˆ˜ì • ëª¨ë“œ";
                document.getElementById('d-day-display').innerText = "-";
            }
        }

        function resetFormForDemo() {
            // ë°ëª¨ìš©: ë‚ ì§œ ë°”ë€” ë•Œë§ˆë‹¤ ì…ë ¥ í¼ ì´ˆê¸°í™” ì‹œëŠ‰
            waterIntake = 0;
            document.getElementById('water-count').innerText = 0;
            painLevel = 0;
            updatePain(0);
            document.querySelector('input[type=range]').value = 0;
            // ì²´í¬ë°•ìŠ¤ë“¤ í•´ì œ... (ìƒëµ)
        }

        // --- íƒ­ ì „í™˜ ---
        function switchTab(tabName) {
            const views = ['tracker', 'calendar', 'stats'];
            views.forEach(v => {
                const el = document.getElementById(`view-${v}`);
                const nav = document.getElementById(`nav-${v}`);
                if (v === tabName) {
                    el.classList.remove('hidden');
                    nav.classList.add('active', 'text-indigo-600');
                    nav.classList.remove('text-gray-400');
                } else {
                    el.classList.add('hidden');
                    nav.classList.remove('active', 'text-indigo-600');
                    nav.classList.add('text-gray-400');
                }
            });
            
            if (tabName === 'calendar') {
                renderCalendar(); // ë‹¬ë ¥ ë³¼ ë•Œë§ˆë‹¤ ë¦¬ë Œë”ë§
            } else if (tabName === 'stats') {
                if(weightChartInstance) weightChartInstance.update();
                if(painChartInstance) painChartInstance.update();
            }
        }

        // --- ê¸°ì¡´ ê¸°ëŠ¥ ë¡œì§ (ìƒë¦¬, ìˆ˜ë©´, í†µì¦ ë“±) ---
        function togglePeriod() {
            isPeriod = !isPeriod;
            const btn = document.getElementById('period-btn');
            const msg = document.getElementById('period-msg');
            if(isPeriod) {
                btn.classList.replace('bg-indigo-500', 'bg-pink-500');
                btn.classList.replace('border-indigo-400', 'border-pink-500');
                btn.innerHTML = '<i class="fas fa-venus text-white"></i> <span class="text-white font-bold">ìƒë¦¬ ì¤‘</span>';
                msg.classList.remove('hidden');
            } else {
                btn.classList.replace('bg-pink-500', 'bg-indigo-500');
                btn.classList.replace('border-pink-500', 'border-indigo-400');
                btn.innerHTML = '<i class="fas fa-venus"></i> <span>ìƒë¦¬ X</span>';
                msg.classList.add('hidden');
            }
        }

        function setSleep(quality) {
            ['good', 'soso', 'bad'].forEach(q => {
                const el = document.getElementById(`sleep-${q}`);
                if(q === quality) {
                    el.classList.remove('grayscale', 'border-gray-200');
                    el.classList.add('grayscale-0', 'border-indigo-500', 'bg-indigo-50', 'ring-1', 'ring-indigo-500');
                } else {
                    el.classList.add('grayscale', 'border-gray-200');
                    el.classList.remove('grayscale-0', 'border-indigo-500', 'bg-indigo-50', 'ring-1', 'ring-indigo-500');
                }
            });
        }

        function updatePain(val) {
            painLevel = val;
            const label = document.getElementById('pain-value');
            const advice = document.getElementById('pain-advice');
            label.innerText = `${val} - `;
            if(val <= 3) {
                label.innerText += "ì–‘í˜¸"; label.className = "font-bold text-green-600";
                advice.innerText = "ìš´ë™í•˜ê¸° ì¢‹ì€ ìƒíƒœì…ë‹ˆë‹¤.";
            } else if(val <= 6) {
                label.innerText += "ì£¼ì˜"; label.className = "font-bold text-yellow-600";
                advice.innerText = "ë¬´ë¦¬í•˜ì§€ ë§ˆì„¸ìš”. ê°•ë„ ë‚®ì¶”ê¸°.";
            } else {
                label.innerText += "ìœ„í—˜"; label.className = "font-bold text-red-600";
                advice.innerText = "ìš´ë™ ì¤‘ë‹¨! ì–¼ìŒì°œì§ˆ í•„ìš”.";
            }
        }

        function toggleCoffee() {
            isCoffeeDrank = !isCoffeeDrank;
            const btn = document.getElementById('coffee-btn');
            if (isCoffeeDrank) {
                btn.classList.remove('text-gray-400', 'border-gray-200');
                btn.classList.add('bg-amber-100', 'text-amber-700', 'border-amber-200');
            } else {
                btn.classList.add('text-gray-400', 'border-gray-200');
                btn.classList.remove('bg-amber-100', 'text-amber-700', 'border-amber-200');
            }
        }

        function addWater() {
            if (waterIntake < 8) {
                waterIntake++;
                document.getElementById('water-count').innerText = waterIntake;
            }
        }

        function setMode(mode) {
            currentMode = mode;
            if(mode === 'work') {
                document.getElementById('btn-work').className = "px-3 py-1.5 rounded-md shadow-sm bg-white text-indigo-600 transition";
                document.getElementById('btn-off').className = "px-3 py-1.5 rounded-md text-gray-400 transition hover:bg-gray-100";
            } else {
                document.getElementById('btn-work').className = "px-3 py-1.5 rounded-md text-gray-400 transition hover:bg-gray-100";
                document.getElementById('btn-off').className = "px-3 py-1.5 rounded-md shadow-sm bg-white text-indigo-600 transition";
            }
            renderExercise();
        }

        function renderMeals() {
            const container = document.getElementById('meal-container');
            container.innerHTML = meals.map((meal, index) => `
                <div class="flex items-center justify-between text-sm">
                    <div class="flex items-center gap-3">
                        <input type="time" value="${meal.time}" class="text-xs font-bold text-gray-500 bg-gray-50 rounded px-1 cursor-pointer outline-none">
                        <div>
                            <div class="font-bold text-gray-700">${meal.name}</div>
                            <div class="text-xs text-gray-400">${meal.desc}</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <select class="text-xs border border-gray-200 rounded p-1 outline-none">
                            <option>ì ì •</option>
                            <option>ë°˜ë§Œ</option>
                            <option>ê³¼ì‹</option>
                            <option>X</option>
                        </select>
                        <input type="checkbox" class="w-5 h-5 accent-green-500 rounded cursor-pointer">
                    </div>
                </div>
            `).join('');
        }

        function renderExercise() {
            const list = routines[currentMode];
            const container = document.getElementById('exercise-list');
            container.innerHTML = list.map((ex, idx) => `
                <li class="bg-white p-3 rounded-xl border border-gray-100 shadow-sm flex items-center cursor-pointer hover:bg-indigo-50 transition" onclick="toggleEx(this)">
                    <div class="w-8 h-8 rounded-full bg-indigo-50 text-indigo-500 flex items-center justify-center mr-3 text-sm">
                        <i class="fas ${ex.icon}"></i>
                    </div>
                    <div class="flex-1">
                        <div class="flex justify-between items-center">
                            <h4 class="font-bold text-sm text-gray-800">${ex.name}</h4>
                            <span class="text-[10px] font-bold text-indigo-400 bg-indigo-50 px-1.5 py-0.5 rounded">${ex.tag}</span>
                        </div>
                        <p class="text-xs text-gray-400">${ex.time}</p>
                    </div>
                    <div class="check-circle w-5 h-5 rounded-full border-2 border-gray-200 ml-2 flex items-center justify-center text-white transition">
                        <i class="fas fa-check text-[10px]"></i>
                    </div>
                </li>
            `).join('');
        }

        function toggleEx(el) {
            const check = el.querySelector('.check-circle');
            const title = el.querySelector('h4');
            if(check.classList.contains('bg-indigo-500')) {
                check.classList.remove('bg-indigo-500', 'border-indigo-500');
                check.classList.add('border-gray-200');
                title.classList.remove('line-through', 'opacity-50');
            } else {
                check.classList.add('bg-indigo-500', 'border-indigo-500');
                check.classList.remove('border-gray-200');
                title.classList.add('line-through', 'opacity-50');
            }
        }

        function saveDailyLog() {
            const toast = document.getElementById('toast');
            toast.classList.remove('opacity-0');
            setTimeout(() => toast.classList.add('opacity-0'), 2000);
            
            // í˜„ì¬ í¸ì§‘ ì¤‘ì¸ ë‚ ì§œì— ê¸°ë¡ ì™„ë£Œ í‘œì‹œ ì¶”ê°€
            const key = formatDateKey(editingDate);
            recordStatus[key] = true;
            
            // ì°¨íŠ¸ ë“± ì—…ë°ì´íŠ¸ (ë°ëª¨)
            const newWeight = document.getElementById('daily-weight').value;
            if(newWeight) {
                weightChartInstance.data.datasets[0].data[6] = newWeight;
                weightChartInstance.update();
            }
            painChartInstance.data.datasets[0].data[6] = painLevel;
            painChartInstance.update();
        }

        function initCharts() {
            const wCtx = document.getElementById('weightChart').getContext('2d');
            weightChartInstance = new Chart(wCtx, {
                type: 'line',
                data: {
                    labels: ['D-6', 'D-5', 'D-4', 'D-3', 'D-2', 'D-1', 'ì˜¤ëŠ˜'],
                    datasets: [{
                        label: 'ì²´ì¤‘', data: [59.8, 59.5, 59.5, 59.2, 59.0, 58.8, 59.0],
                        borderColor: '#4F46E5', tension: 0.4, borderWidth: 2, pointBackgroundColor:'#fff'
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: {display:false} }, scales: { y: { suggestedMin: 57, suggestedMax: 61 } } }
            });

            const pCtx = document.getElementById('painChart').getContext('2d');
            painChartInstance = new Chart(pCtx, {
                type: 'bar',
                data: {
                    labels: ['D-6', 'D-5', 'D-4', 'D-3', 'D-2', 'D-1', 'ì˜¤ëŠ˜'],
                    datasets: [{
                        label: 'í†µì¦ ë ˆë²¨', data: [2, 1, 3, 5, 2, 1, 0],
                        backgroundColor: (ctx) => {
                            const val = ctx.raw;
                            return val > 6 ? '#EF4444' : (val > 3 ? '#FBBF24' : '#10B981');
                        },
                        borderRadius: 4
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: {display:false} }, scales: { y: { min: 0, max: 10 } } }
            });
        }
    </script>
</body>
</html>